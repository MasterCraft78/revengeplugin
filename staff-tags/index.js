(function(C,d,s,a,f,g,E,R,B){"use strict";const{Permissions:T}=a.constants,{computePermissions:v}=s.findByProps("computePermissions","canEveryoneRole"),_=s.findByStoreName("GuildMemberStore"),M=[a.i18n.Messages.AI_TAG,a.i18n.Messages.BOT_TAG_BOT,a.i18n.Messages.BOT_TAG_SERVER,a.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,a.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,a.i18n.Messages.REMIXING_TAG],h=[{text:"WEBHOOK",condition:function(t,o,n){return n.isNonUserBot()}},{text:"OWNER",condition:function(t,o,n){return t?.ownerId===n.id}},{text:"ADMIN",permissions:["ADMINISTRATOR"]},{text:"STAFF",llbackgroundColor:g.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]},{text:"VC Mod",permissions:["MOVE_MEMBERS","MUTE_MEMBERS","DEAFEN_MEMBERS"]},{text:"Chat Mod",permissions:["MODERATE_MEMBERS"]}];function y(t,o,n){let l;if(t){const e=v({user:n,context:t,overwrites:o?.permissionOverwrites});l=Object.entries(T).map(function([i,r]){return e&r?i:""}).filter(Boolean)}for(const e of h)if(e.condition?.(t,o,n)||!n.bot&&e.permissions?.some(function(i){return l?.includes(i)})){let i=d.storage.useRoleColor?_.getMember(t?.id,n.id)?.colorString:void 0,r=i||(e.backgroundColor??g.rawColors.BRAND_500),c=i||!e.textColor?a.chroma(r).get("lab.l")<70?g.rawColors.WHITE_500:g.rawColors.BLACK_500:e.textColor;return{...e,textColor:c,backgroundColor:r,verified:typeof e.verified=="function"?e.verified(t,o,n):e.verified??!1,condition:void 0,permissions:void 0}}}const N=s.findByName("getTagProperties",!1),A=s.findByStoreName("GuildStore"),b=s.findByStoreName("ChannelStore");function G(){return f.after("default",N,function([{message:t}],o){if(!M.includes(o.tagText)){const n=b.getChannel(t.channel_id),l=A.getGuild(n?.guild_id),e=y(l,n,t.author);if(e)return{...o,tagText:e.text,tagTextColor:e.textColor?a.ReactNative.processColor(a.chroma(e.textColor).hex()):void 0,tagBackgroundColor:e.backgroundColor?a.ReactNative.processColor(a.chroma(e.backgroundColor).hex()):void 0,tagVerified:e.verified,tagType:void 0}}})}const S=s.findByProps("getBotLabel"),I=S?.getBotLabel,O=s.findByStoreName("GuildStore"),k=function([{guildId:t,user:o}],n){const l=n?.props?.label,e=E.findInReactTree(l,function(c){return c?.type?.Types});if(e){const c=I?.(e.props.type);if(M.includes(c))return}const i=O.getGuild(t),r=y(i,void 0,o);if(r)if(e)Object.assign(e.props,{type:0,text:r.text,textColor:r.textColor,backgroundColor:r.backgroundColor,verified:r.verified});else{const c=l.props?.children;c&&c.splice(1,0,React.createElement(S.default,{type:0,text:r.text,textColor:r.textColor,backgroundColor:r.backgroundColor,verified:r.verified}))}};function m(){const t=[];return s.findByTypeNameAll("UserRow").forEach(function(o){return t.push(f.after("type",o,k))}),function(){return t.forEach(function(o){return o()})}}const D=s.findByName("DisplayName",!1),L=s.findByName("HeaderName",!1),x=s.findByProps("getBotLabel"),w=x.getBotLabel,$=s.findByStoreName("GuildStore"),P=s.findByStoreName("ChannelStore");function U(){const t=[];return t.push(f.after("default",L,function([{channelId:o}],n){n.props.channelId=o})),t.push(f.after("default",D,function([{guildId:o,channelId:n,user:l}],e){const i=E.findInReactTree(e,function(r){return r.type.Types});if(!i||!M.includes(w(i.props.type))){const r=$.getGuild(o),c=P.getChannel(n),u=y(r,c,l);u&&(i?i.props={type:0,...u}:E.findInReactTree(e,function(Y){return Y.props.style.flexDirection==="row"}).props.children.push(React.createElement(x.default,{style:{marginLeft:0},type:0,text:u.text,textColor:u.textColor,backgroundColor:u.backgroundColor,verified:u.verified})))}})),function(){return t.forEach(function(o){return o()})}}const F=s.findByProps("getBotLabel");function V(){return f.after("default",F,function([{text:t,textColor:o,backgroundColor:n}],l){const e=E.findInReactTree(l,function(i){return typeof i.props.children=="string"});t&&(e.props.children=t),o&&e.props.style.push({color:o}),n&&l.props.style.push({backgroundColor:n})})}const{ScrollView:H}=B.General,{FormSection:K,FormSwitchRow:W}=B.Forms;function j(){return R.useProxy(d.storage),React.createElement(H,{style:{flex:1}},React.createElement(K,{title:"Tag style"},React.createElement(W,{label:"Use top role color for tag backgrounds",value:d.storage.useRoleColor,onValueChange:function(t){d.storage.useRoleColor=t}})))}let p=[];var X={onLoad:function(){d.storage.useRoleColor??=!1,p.push(G()),p.push(V()),p.push(U()),p.push(m())},onUnload:function(){return p.forEach(function(t){return t()})},settings:j};return C.default=X,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
