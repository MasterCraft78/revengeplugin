(function(C,u,i,c,f,y,p,T,B){"use strict";const{Permissions:A}=c.constants,{computePermissions:R}=i.findByProps("computePermissions","canEveryoneRole"),v=i.findByStoreName("GuildMemberStore"),M=[c.i18n.Messages.AI_TAG,c.i18n.Messages.BOT_TAG_BOT,c.i18n.Messages.BOT_TAG_SERVER,c.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,c.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,c.i18n.Messages.REMIXING_TAG],_=[{text:"WEBHOOK",condition:function(t,r,o){return o.isNonUserBot()}},{text:"OWNER",condition:function(t,r,o){return t?.ownerId===o.id}},{text:"ADMIN",permissions:["ADMINISTRATOR"]},{text:"STAFF",permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]},{text:"VC Mod",permissions:["MOVE_MEMBERS","MUTE_MEMBERS","DEAFEN_MEMBERS"]},{text:"Chat Mod",permissions:["MODERATE_MEMBERS"]}];function h(t,r,o){let l;if(t){const e=R({user:o,context:t,overwrites:r?.permissionOverwrites});l=Object.entries(A).map(function([n,d]){return e&d?n:""}).filter(Boolean)}for(const e of _)if(e.condition?.(t,r,o)||!o.bot&&e.permissions?.some(function(n){return l?.includes(n)})){let n=u.storage.useRoleColor?v.getMember(t?.id,o.id)?.colorString:void 0,d=n||(e.backgroundColor??y.rawColors.BRAND_500),s=n||!e.textColor?c.chroma(d).get("lab.l")<70?y.rawColors.WHITE_500:y.rawColors.BLACK_500:e.textColor;return{...e,textColor:s,backgroundColor:d,verified:typeof e.verified=="function"?e.verified(t,r,o):e.verified??!1,condition:void 0,permissions:void 0}}}const N=i.findByName("getTagProperties",!1),b=i.findByStoreName("GuildStore"),G=i.findByStoreName("ChannelStore");function I(){return f.after("default",N,function([{message:t}],r){if(!M.includes(r.tagText)){const o=G.getChannel(t.channel_id),l=b.getGuild(o?.guild_id),e=h(l,o,t.author);if(e)return{...r,tagText:e.text,tagTextColor:e.textColor?c.ReactNative.processColor(c.chroma(e.textColor).hex()):void 0,tagBackgroundColor:e.backgroundColor?c.ReactNative.processColor(c.chroma(e.backgroundColor).hex()):void 0,tagVerified:e.verified,tagType:void 0}}})}const S=i.findByProps("getBotLabel"),O=S?.getBotLabel,m=i.findByStoreName("GuildStore"),k=function([{guildId:t,user:r}],o){const l=o?.props?.label,e=p.findInReactTree(l,function(a){return Array.isArray(a?.props?.children)&&a.props.children.some(function(E){return typeof E=="string"||typeof E?.props?.children=="string"})}),n=p.findInReactTree(e,function(a){return a?.type?.Types});if(n){const a=O?.(n.props.type);if(M.includes(a))return}const d=m.getGuild(t),s=h(d,void 0,r);s&&(n?Object.assign(n.props,{type:0,text:s.text,textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified}):(Array.isArray(e.props.children)||(e.props.children=[e.props.children]),e.props.children.push(React.createElement(S.default,{type:0,text:s.text,textColor:s.textColor,backgroundColor:s.backgroundColor,verified:s.verified}))))};function D(){const t=[];return i.findByTypeNameAll("UserRow").forEach(function(r){return t.push(f.after("type",r,k))}),function(){return t.forEach(function(r){return r()})}}const L=i.findByName("DisplayName",!1),$=i.findByName("HeaderName",!1),x=i.findByProps("getBotLabel"),w=x.getBotLabel,P=i.findByStoreName("GuildStore"),U=i.findByStoreName("ChannelStore");function F(){const t=[];return t.push(f.after("default",$,function([{channelId:r}],o){o.props.channelId=r})),t.push(f.after("default",L,function([{guildId:r,channelId:o,user:l}],e){const n=p.findInReactTree(e,function(d){return d.type.Types});if(!n||!M.includes(w(n.props.type))){const d=P.getGuild(r),s=U.getChannel(o),a=h(d,s,l);a&&(n?n.props={type:0,...a}:p.findInReactTree(e,function(E){return E.props.style.flexDirection==="row"}).props.children.push(React.createElement(x.default,{style:{marginLeft:0},type:0,text:a.text,textColor:a.textColor,backgroundColor:a.backgroundColor,verified:a.verified})))}})),function(){return t.forEach(function(r){return r()})}}const V=i.findByProps("getBotLabel");function H(){return f.after("default",V,function([{text:t,textColor:r,backgroundColor:o}],l){const e=p.findInReactTree(l,function(n){return typeof n.props.children=="string"});t&&(e.props.children=t),r&&e.props.style.push({color:r}),o&&l.props.style.push({backgroundColor:o})})}const{ScrollView:K}=B.General,{FormSection:W,FormSwitchRow:j}=B.Forms;function X(){return T.useProxy(u.storage),React.createElement(K,{style:{flex:1}},React.createElement(W,{title:"Tag style"},React.createElement(j,{label:"Use top role color for tag backgrounds",value:u.storage.useRoleColor,onValueChange:function(t){u.storage.useRoleColor=t}})))}let g=[];var Y={onLoad:function(){u.storage.useRoleColor??=!1,g.push(I()),g.push(H()),g.push(F()),g.push(D())},onUnload:function(){return g.forEach(function(t){return t()})},settings:X};return C.default=Y,Object.defineProperty(C,"__esModule",{value:!0}),C})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
