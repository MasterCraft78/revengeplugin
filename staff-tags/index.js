(function(E,f,s,a,p,u,C,N,x){"use strict";const{Permissions:R}=a.constants,{computePermissions:_}=s.findByProps("computePermissions","canEveryoneRole"),b=s.findByStoreName("GuildMemberStore"),y=[a.i18n.Messages.AI_TAG,a.i18n.Messages.BOT_TAG_BOT,a.i18n.Messages.BOT_TAG_SERVER,a.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,a.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,a.i18n.Messages.REMIXING_TAG],A=[{text:"WEBHOOK",condition:function(t,o,r){return r.isNonUserBot()}},{text:"OWNER",backgroundColor:u.rawColors.ORANGE_345,condition:function(t,o,r){return t?.ownerId===r.id}},{text:"ADMIN",backgroundColor:u.rawColors.RED_560,permissions:["ADMINISTRATOR"]},{text:"MANAGER",backgroundColor:u.rawColors.GREEN_345,permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"MOD",backgroundColor:u.rawColors.BLUE_345,permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]}];function B(t,o,r){let l;if(t){const e=_({user:r,context:t,overwrites:o?.permissionOverwrites});l=Object.entries(R).map(function([i,n]){return e&n?i:""}).filter(Boolean)}for(const e of A)if(e.condition?.(t,o,r)||!r.bot&&e.permissions?.some(function(i){return l?.includes(i)})){let i=f.storage.useRoleColor?b.getMember(t?.id,r.id)?.colorString:void 0,n=i||(e.backgroundColor??u.rawColors.BRAND_500),c=i||!e.textColor?a.chroma(n).get("lab.l")<70?u.rawColors.WHITE_500:u.rawColors.BLACK_500:e.textColor;return{...e,textColor:c,backgroundColor:n,verified:typeof e.verified=="function"?e.verified(t,o,r):e.verified??!1,condition:void 0,permissions:void 0}}}const h=s.findByName("getTagProperties",!1),T=s.findByStoreName("GuildStore"),G=s.findByStoreName("ChannelStore");function M(){return p.after("default",h,function([{message:t}],o){if(!y.includes(o.tagText)){const r=G.getChannel(t.channel_id),l=T.getGuild(r?.guild_id),e=B(l,r,t.author);if(e)return{...o,tagText:e.text,tagTextColor:e.textColor?a.ReactNative.processColor(a.chroma(e.textColor).hex()):void 0,tagBackgroundColor:e.backgroundColor?a.ReactNative.processColor(a.chroma(e.backgroundColor).hex()):void 0,tagVerified:e.verified,tagType:void 0}}})}const v=s.findByProps("getBotLabel"),I=v?.getBotLabel,k=s.findByStoreName("GuildStore"),O=function([{guildId:t,user:o}],r){const l=r?.props?.label,e=C.findInReactTree(l,function(c){return c?.type?.Types});if(e){const c=I?.(e.props.type);if(y.includes(c))return}const i=k.getGuild(t),n=B(i,void 0,o);if(n)if(e)Object.assign(e.props,{type:0,text:n.text,textColor:n.textColor,backgroundColor:n.backgroundColor,verified:n.verified});else{const c=l.props?.children;c&&c.splice(1,0,React.createElement(v.default,{type:0,text:n.text,textColor:n.textColor,backgroundColor:n.backgroundColor,verified:n.verified}))}};function w(){const t=[];return s.findByTypeNameAll("UserRow").forEach(function(o){return t.push(p.after("type",o,O))}),function(){return t.forEach(function(o){return o()})}}const L=s.findByName("DisplayName",!1),D=s.findByName("HeaderName",!1),S=s.findByProps("getBotLabel"),m=S.getBotLabel,P=s.findByStoreName("GuildStore"),U=s.findByStoreName("ChannelStore");function $(){const t=[];return t.push(p.after("default",D,function([{channelId:o}],r){r.props.channelId=o})),t.push(p.after("default",L,function([{guildId:o,channelId:r,user:l}],e){const i=C.findInReactTree(e,function(n){return n.type.Types});if(!i||!y.includes(m(i.props.type))){const n=P.getGuild(o),c=U.getChannel(r),d=B(n,c,l);d&&(i?i.props={type:0,...d}:C.findInReactTree(e,function(Y){return Y.props.style.flexDirection==="row"}).props.children.push(React.createElement(S.default,{style:{marginLeft:0},type:0,text:d.text,textColor:d.textColor,backgroundColor:d.backgroundColor,verified:d.verified})))}})),function(){return t.forEach(function(o){return o()})}}const H=s.findByProps("getBotLabel");function K(){return p.after("default",H,function([{text:t,textColor:o,backgroundColor:r}],l){const e=C.findInReactTree(l,function(i){return typeof i.props.children=="string"});t&&(e.props.children=t),o&&e.props.style.push({color:o}),r&&l.props.style.push({backgroundColor:r})})}const{ScrollView:V}=x.General,{FormSection:W,FormSwitchRow:j}=x.Forms;function F(){return N.useProxy(f.storage),React.createElement(V,{style:{flex:1}},React.createElement(W,{title:"Tag style"},React.createElement(j,{label:"Use top role color for tag backgrounds",value:f.storage.useRoleColor,onValueChange:function(t){f.storage.useRoleColor=t}})))}let g=[];var X={onLoad:function(){f.storage.useRoleColor??=!1,g.push(M()),g.push(K()),g.push($()),g.push(w())},onUnload:function(){return g.forEach(function(t){return t()})},settings:F};return E.default=X,Object.defineProperty(E,"__esModule",{value:!0}),E})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
